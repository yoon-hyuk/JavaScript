<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style type ="text/css">
        .note{
            border: 1px solid;
            min-height: 300px;
        }
    </style>
    <script>
    let $ = function(cssSelector, message){
     
        let htmlElements = document.querySelectorAll(cssSelector);
     
        if(message){
            htmlElements.forEach(e => {e.innerHTML += message + '<br>'});
        }
        return htmlElements;
    }
    </script>
</head>
<body>
    <h1>this</h1>
    <h2>1. 함수에서의 this</h2>
    <pre>
        this는 arguments처럼 함수가 실행될 때 함께 함수에 전달이 된다.
        함수 내부에서의 this는 전역객체(window)를 참조하고있다.
    </pre>

    <div id="thisNote" class="note"></div>
    <script>
        //window객체에 속성으로 등록하기 위해 var를 사용
        var who = '전역객체의 who입니다.';

        function info(){
            var who = 'info함수의 who입니다.';
            $('#thisNote',`who : ${who}`);  //info함수의 who입니다.
            $('#thisNote',`this.who : ${this.who}`);  // 전액객체의 who입니다.
            console.dir(this);
        }

        info();

    </script>

    <h2>2. 메서드에서의 this</h2>
    <pre>
        메서드 안에서의 this는 해당 메서드를 호출할 때 사용한 객체가 바인딩된다.
    </pre>
    <div id = "thisNote2" class="note"></div>
    <script>
        var methodWho = '전역객체의 who입니다.'

        let multicampus = {
            methodWho : '멀티캠퍼스의 who입니다.',
            info : function(){
                $('#thisNote2',this.methodWho);
                console.dir(this);
            }
        }

        let saffy = {
            methodWho:'saffy의 who입니다.',
            info:multicampus.info
        }

        multicampus.info();
        saffy.info();

    </script>

    <h2>3. 생성자 함수에서의 this</h2>
    <pre>
        생성자 함수는 자신이 호출되는 시점에, 함수의 실행결과로 반환될 빈 객체를 생성하고, this 레퍼런스에 참조시킨다.
        생성자 함수로 상용될 때 return이 없다면 자동으로 this를 반환한다.

        만약 return문이 존재한다면,
        1. 기본타입을 반환하는 return문이라면 무시하고 this를 반환한다.
        2. 객체를 반환하는 return문이라면 return문에 명시한 객체를 반환하다.
    </pre>
    <div id="thisNote3" class="note"></div>
    <script>
        function Info(){
            this.Info = function(){
                $('#thisNote3',this.who);         //멀티캠퍼스 학생
            }
        }

        let multicampusInfo = new Info(); 
        multicampusInfo.who = '멀티캠퍼스 학생';
        multicampusInfo.Info();
    </script>

    <h2>4. 화살표함수에서의 this</h2>
    <pre>
        화살표함수는 호출될 때 this를 전달받지 않는다.
        화살표함수는 this를 전달받지 않기 때문에, 객체의 메서드나 생성자 함수에서 메서드를 선언할 때는 사용하지 않는다.
        화살표함수에서의 this는 상위스코프의 this가 된다.
    </pre>
    <div id="thisNote4" class="note"></div>
    <script>
        let outerFnc = ()=>{
            $('#thisNote4',`전역에 선언된 화살표 함수의 this : ${this.who}`); // 전역객체
            console.dir(this);
        }

        outerFnc();

        let testObj = {

            who:'testObj의 who입니다.',

            fnc : function(){
                $('#thisNote4',`메서드로 작성된 일반 함수의 this : ${this.who}`); // tesObj의 who
                console.dir(this);
            },

            arrow : () => {
                $('#thisNote4',`메서드로 작성된 화살표 함수의 this : ${this.who}`); // 전역객체의 who
                console.dir(this);
            },

            innerFnc : function(){
                let that = this;

                (function(){
                    $('#thisNote4',`메서드안에 함수로 작성된 일반함수의 that : ${that.who}`); // testObj의 who
                    console.dir(this);
                    console.dir(that);
                })();
            }

        }
        testObj.fnc();
        testObj.arrow();
        testObj.innerFnc();

    </script>
    <h2>5. 명시적 this 바인딩</h2>
    <div id = "thisNote5" class = "note"></div>
    <script>

        let mc = {
            who:'홍길동[멀티캠퍼스]',
            age:15,
            info:function(){
                $('#thisNote5',`이름 : ${this.who} / 나이 : ${this.age}`);
                console.dir(this);
            }
        }

        let kitri = {
            who:'성춘향[키트리]',
            age:17,
            info:function(){
                $('#thisNote5',`이름 : ${this.who} / 나이 : ${this.age}`);
                console.dir(this);
            }
        }

        function changeInfo(who, age){
            this.who = who;
            this.age = age;
        }

        // Functon객체의 apply, call메서드를 사용해 this를 명시적으로 바인딩할 수 있다.
        mc.info.apply(kitri);       // this에 kitri를 바인딩
        kitri.info.apply(mc);       // this에 mc를 바인딩

        changeInfo.apply(mc,['윤수정[멀티캠퍼스]',100]);
        mc.info();

        changeInfo.apply(kitri,['윤혁[멀티캠퍼스]',100]);
        kitri.info();


    </script>


</body>

</html>